<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reservas Hoy - Coordinador</title>

    <!-- Estilos -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/coordinador_sidebar.css}">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
<div class="wrapper">
    <!-- Sidebar -->
    <div th:replace="~{fragments/sidebar-coordinador :: sidebar}"></div>

    <<!-- Main -->
    <div class="main bg-white">
        <!-- Navbar -->
        <div th:replace="~{fragments/navbar-coordinador :: navbar}"></div>

        <main class="content">
            <div class="container mt-4">
                <h2>Detalle de Reserva</h2>

                <p><strong>Usuario:</strong> <span th:text="${reserva.usuario.nombres + ' ' + reserva.usuario.apellidos}"></span></p>
                <p><strong>Fecha de reserva:</strong> <span th:text="${reserva.fechaReserva}"></span></p>
                <p><strong>Servicio:</strong> <span th:text="${reserva.sedeServicio.servicio.nombre}"></span></p>
                <p><strong>Sede:</strong> <span th:text="${reserva.sedeServicio.sede.nombre}"></span></p>
                <p><strong>Estado:</strong> <span th:text="${reserva.estado.nombre}"></span></p>

                <hr>



                <hr>

                <h4>Incidencia</h4>
                <div th:if="${#lists.isEmpty(incidencias)}">
                    No se ha registrado incidencia.
                </div>
                <div th:if="${!#lists.isEmpty(incidencias)}">
                    <ul>
                        <li th:each="inc : ${incidencias}">
                            <strong>Fecha:</strong> <span th:text="${#temporals.format(inc.fechaLocal, 'yyyy-MM-dd HH:mm')}"></span><br>
                            <strong>Descripción:</strong> <span th:text="${inc.descripcion}"></span>
                        </li>
                    </ul>
                </div>
            </div>
        </main>


        <!-- Footer -->
        <footer class="footer mt-auto py-3">
            <div class="text-center mt-5 mb-3">
                <img th:src="@{/img/photos/logo-san-miguel.png}" alt="Logo" height="60">
            </div>
            <div class="container text-center text-muted">
                Municipalidad de San Miguel © 2025
            </div>
        </footer>
    </div>
</div>

<!-- Modal -->
<div id="popupModal" class="modal-overlay" style="display: none;">
    <div class="modal-box">
        <h5 class="mb-3">Estás fuera de la zona permitida</h5>
        <button class="btn btn-primary" onclick="cerrarModal()">Cerrar</button>
    </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const modal = document.getElementById('popupModal');
    const btnSalida = document.getElementById('btnSalida');
    const sedeLat = /*[[${latitud}]]*/ 0;
    const sedeLon = /*[[${longitud}]]*/ 0;

    function cerrarModal() {
        modal.style.display = 'none';
    }



    // ⏰ Reloj en vivo
    function actualizarHora() {
        const reloj = document.getElementById('reloj');
        if (!reloj) return;
        const ahora = new Date();
        const hora = ahora.toLocaleTimeString('es-PE', {
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
        });
        reloj.textContent = hora;
    }
    setInterval(actualizarHora, 1000);
    actualizarHora();

    document.addEventListener("DOMContentLoaded", function () {
        const toggle = document.querySelector(".js-sidebar-toggle");
        const sidebar = document.getElementById('sidebar');
        if (toggle) {
            toggle.addEventListener("click", function (e) {
                e.preventDefault();
                document.body.classList.toggle("sidebar-collapsed");
            });
        }
    });

    const filtro = document.getElementById("filtro");
    const filas = document.querySelectorAll("#tablaReservas tr");

    filtro.addEventListener("input", () => {
        const texto = filtro.value.toLowerCase();
        filas.forEach(fila => {
            const contenido = fila.textContent.toLowerCase();
            fila.style.display = contenido.includes(texto) ? "" : "none";
        });
    });
</script>
</body>
</html>
